<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interval</title>
  
  <!-- p5.js libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/addons/p5.sound.min.js"></script>
  
  <!-- Custom styles -->
  <link rel="stylesheet" href="css/style.css?v=80">
  
  <!-- Application modules -->
  <script src="js/IntervalMaker.js?v=71"></script>
  <script src="js/SoundManager.js?v=70"></script>
  <script src="js/Instrument.js?v=70"></script>
  <script src="js/ScaleVisualizer.js?v=70"></script>
  <script src="js/SoundVisualizer.js?v=70"></script>
  <script src="js/SequencePlayer.js?v=73"></script>
  <script src="js/sketch.js?v=77"></script>
</head>
<body>
  <div id="app-container">
    <!-- Canvas fills the screen -->
    <div id="canvas-container"></div>
    
    <!-- Floating control panel -->
    <div id="controls-panel" class="expanded">
      <button id="toggle-panel" class="toggle-btn" title="Toggle Controls">
        <span class="icon">⚙</span>
      </button>
      
      <div class="panel-content">
        <div class="control-group">
          <label for="instrument-select">Temperament</label>
          <select id="instrument-select" title="Choose a tuning system. Equal Tempered is modern standard; others have historical character.">
            <option value="Equal Tempered" selected>Equal Tempered</option>
            <option value="Well Tempered">Well Tempered</option>
            <option value="Carlos Super Just">Carlos Super Just</option>
            <option value="Pythagorean">Pythagorean</option>
          </select>
        </div>
        
        <div class="control-group">
          <label for="note-select">Root</label>
          <select id="note-select" title="Select the root note for the scale. All other notes are relative to this.">
            <option value="A">A</option>
            <option value="A#">A♯</option>
            <option value="B">B</option>
            <option value="C" selected>C</option>
            <option value="C#">C♯</option>
            <option value="D">D</option>
            <option value="D#">D♯</option>
            <option value="E">E</option>
            <option value="F">F</option>
            <option value="F#">F♯</option>
            <option value="G">G</option>
            <option value="G#">G♯</option>
          </select>
        </div>
        
        <div class="control-group">
          <label for="scale-select">Scale</label>
          <select id="scale-select" title="Choose a scale or mode. Notes in the scale appear bright; others are dimmed.">
            <optgroup label="Scales">
              <option value="Major" selected>Major</option>
              <option value="Minor">Minor</option>
              <option value="Minor Pent.">Minor Pent.</option>
              <option value="Major Pent.">Major Pent.</option>
              <option value="Blues">Blues</option>
            </optgroup>
            <optgroup label="Modes">
              <option value="Ionian">Ionian</option>
              <option value="Dorian">Dorian</option>
              <option value="Phrygian">Phrygian</option>
              <option value="Lydian">Lydian</option>
              <option value="Mixolydian">Mixolydian</option>
              <option value="Aeolian">Aeolian</option>
              <option value="Locrian">Locrian</option>
            </optgroup>
          </select>
          <div id="scale-info" class="scale-info"></div>
        </div>
        
        <div class="control-group">
          <label for="progression-select">Progression</label>
          <select id="progression-select" title="Chord progressions adapt to the current scale - qualities change based on mode.">
            <option value="None">None</option>
            <option value="1-4-5-1">1-4-5-1 (Classic)</option>
            <option value="1-5-6-4">1-5-6-4 (Pop)</option>
            <option value="2-5-1">2-5-1 (Jazz)</option>
            <option value="1-6-4-5">1-6-4-5 (50s)</option>
            <option value="6-4-1-5">6-4-1-5</option>
            <option value="1-4-6-5">1-4-6-5</option>
            <option value="12 Bar Blues">12 Bar Blues</option>
          </select>
        </div>
        
        <div class="progression-controls hidden" id="progression-controls">
          <div class="prog-row">
            <button id="play-prog-btn" class="prog-btn" title="Play or stop the chord progression">▶</button>
            <span id="progression-display" class="prog-display" title="Current chord in the progression">-</span>
          </div>
          <select id="speed-select" class="speed-select" title="Tempo - time between chord changes">
            <option value="2000">Slow</option>
            <option value="1000" selected>Medium</option>
            <option value="500">Fast</option>
          </select>
        </div>
        
        <div class="divider"></div>
        
        <div class="control-group">
          <label>Order:</label>
          <div class="segmented-control" title="Arrange notes chromatically (by step) or by harmonic relationship (Fifths)">
            <input type="radio" name="order-mode" id="order-chromatic" value="chromatic" checked>
            <label for="order-chromatic">Chromatic</label>
            <input type="radio" name="order-mode" id="order-fifths" value="fifths">
            <label for="order-fifths">Fifths</label>
            <div class="segmented-slider"></div>
          </div>
        </div>
        
        <div class="control-group">
          <label>Colors:</label>
          <div class="segmented-control" title="Choose whether note colors represent frequency (Chromatic) or harmonic relationships (Fifths)">
            <input type="radio" name="color-mode" id="color-chromatic" value="chromatic" checked>
            <label for="color-chromatic">Chromatic</label>
            <input type="radio" name="color-mode" id="color-fifths" value="fifths">
            <label for="color-fifths">Fifths</label>
            <div class="segmented-slider"></div>
          </div>
        </div>
        
        <div class="control-group">
          <label>Spectrum:</label>
          <div class="segmented-control" title="Show a spectrum visualizer around the wheel that reacts to playing notes">
            <input type="radio" name="spectrum-mode" id="spectrum-off" value="off" checked>
            <label for="spectrum-off">Off</label>
            <input type="radio" name="spectrum-mode" id="spectrum-on" value="on">
            <label for="spectrum-on">On</label>
            <div class="segmented-slider"></div>
          </div>
        </div>
        
        <div class="divider"></div>
        
        <div class="bottom-actions">
          <button id="help-btn" class="action-btn help" title="Show help and information">?</button>
          <button id="reset-btn" class="reset-btn" title="Reset app and show welcome screen">Reset</button>
        </div>
      </div>
    </div>
    
    <!-- Note tooltip -->
    <div id="note-tooltip" class="hidden"></div>
    
    <!-- Status bar (shown when help is visible) -->
    <div id="help-status-bar">
      <div class="status-config"></div>
      <div class="status-chord">No notes playing</div>
    </div>
    
    <!-- Help modal -->
    <div id="help-panel" class="hidden">
      <div class="help-modal">
        <div class="help-header">
          <h2>Interval</h2>
          <button id="close-help-btn">&times;</button>
        </div>
        <div class="help-content">
          <p class="credit">Copyright Shawn T. O'Neil, 2013 | p5.js port 2024</p>
          
          <h3>What is Interval?</h3>
          <p>Interval is an interactive tool for exploring music theory. It visualizes notes, scales, and chords on a circular display, and lets you hear how different tuning systems affect the sound of music.</p>
          
          <h3>Playing Notes</h3>
          <p>There are two ways to play notes:</p>
          <ul>
            <li><strong>Number row</strong> (<kbd>1</kbd> through <kbd>=</kbd>): Plays all 12 notes in Western music, starting from your chosen root note. These are the "chromatic" notes - every key on a piano, both white and black.</li>
            <li><strong>Letter row</strong> (<kbd>q</kbd> through <kbd>]</kbd>): Plays only the notes in your selected scale (usually 7 notes). This makes it easy to improvise without hitting "wrong" notes.</li>
          </ul>
          <p>You can also click notes on the wheel. When you play multiple notes together, the app identifies the <strong>chord</strong> (a group of notes that sound good together) and displays its name in the center. Common chords include <a href="#" class="demo-link" data-sequence="Equal Tempered,C,Major|C+E+G|1500">major (happy/bright)</a>, <a href="#" class="demo-link" data-sequence="Equal Tempered,C,Minor|C+D#+G|1500">minor (sad/dark)</a>, and <a href="#" class="demo-link" data-sequence="Equal Tempered,C,Major|C+E+G+A#|1500">seventh chords (jazzy/complex)</a>.</p>
          
          <h3>The Wheel</h3>
          <p>The wheel shows all 12 notes arranged in a circle. Bright notes are "in the scale" - they belong to your selected key and will sound harmonious together. Dimmed notes are "outside the scale" - they can add tension or color but may clash.</p>
          <p><strong>Circle of Fifths:</strong> This toggle changes how notes are arranged. Normally notes go up by half-steps (C, C#, D, D#...). The Circle of Fifths arranges them by "fifths" instead (C, G, D, A...). A <a href="#" class="demo-link" data-sequence="Equal Tempered,C,Major|C+G|1500">fifth</a> is the interval from "do" to "sol" - one of the most consonant sounds in music. This arrangement reveals why certain chords sound good together: neighbors on the circle share many notes.</p>
          <p><strong>Chromatic Colors:</strong> Changes whether colors represent pitch (low=red to high=violet) or position in the circle of fifths.</p>
          <p>The small dot shows the <strong>relative major/minor</strong>. Every major key has a "relative minor" that shares all the same notes but starts on a different root. For example, C Major and A Minor use the same seven notes (all white keys on a piano).</p>
          
          <h3>Scales and Modes</h3>
          <p>A <strong>scale</strong> is a collection of notes that sound good together. The most common are:</p>
          <ul>
            <li><a href="#" class="demo-link" data-sequence="Equal Tempered,C,Major|C+E+G|1500"><strong>Major</strong></a> - Bright and happy (think "Happy Birthday")</li>
            <li><a href="#" class="demo-link" data-sequence="Equal Tempered,C,Minor|C+D#+G|1500"><strong>Minor</strong></a> - Dark and melancholy (think minor-key movie themes)</li>
            <li><a href="#" class="demo-link" data-sequence="Equal Tempered,C,Minor Pent.|C+D#+G|1500"><strong>Pentatonic</strong></a> - A 5-note scale common in rock, blues, and folk music worldwide</li>
            <li><a href="#" class="demo-link" data-sequence="Equal Tempered,C,Blues|C+D#+F#+G|1500"><strong>Blues</strong></a> - Pentatonic plus one extra "blue note" that gives it that bluesy sound</li>
          </ul>
          <p><strong>Modes</strong> are variations of a "parent" major scale, each starting on a different note. Modes of the same parent scale share all the same notes but have different "home bases," creating distinct moods:</p>
          <ul>
            <li><a href="#" class="demo-link" data-sequence="Equal Tempered,C,Ionian|C+E+G|1500"><strong>Ionian</strong></a> - The standard major scale</li>
            <li><a href="#" class="demo-link" data-sequence="Equal Tempered,D,Dorian|D+F+A|1500"><strong>Dorian</strong></a> - Minor but with a brighter 6th; common in jazz and Celtic music</li>
            <li><a href="#" class="demo-link" data-sequence="Equal Tempered,E,Phrygian|E+G+B|1500"><strong>Phrygian</strong></a> - Minor with a dark, Spanish/Middle Eastern flavor</li>
            <li><a href="#" class="demo-link" data-sequence="Equal Tempered,F,Lydian|F+A+C|1500"><strong>Lydian</strong></a> - Major but dreamy and floating; the "Simpsons theme" sound</li>
            <li><a href="#" class="demo-link" data-sequence="Equal Tempered,G,Mixolydian|G+B+D|1500"><strong>Mixolydian</strong></a> - Major but with a bluesy 7th; common in rock</li>
            <li><a href="#" class="demo-link" data-sequence="Equal Tempered,A,Aeolian|A+C+E|1500"><strong>Aeolian</strong></a> - The natural minor scale</li>
            <li><a href="#" class="demo-link" data-sequence="Equal Tempered,B,Locrian|B+D+F|1500"><strong>Locrian</strong></a> - Unstable and tense; rarely used as a "home" scale</li>
          </ul>
          <p>The app shows which "parent" major key shares the same notes. For instance, D Dorian uses the same notes as C Major - it's just "C Major starting on D."</p>
          
          <h3>Chord Progressions</h3>
          <p>A <strong>chord progression</strong> is a sequence of chords. Most songs use the same few progressions. The numbers (1, 4, 5, etc.) refer to scale degrees - if you're in C Major, 1=C, 4=F, 5=G.</p>
          <p>Progressions are <strong>mode-aware</strong>: the same "1-4-5" pattern produces major chords in a major key but minor chords in a minor key. Try switching between C Major and C Minor while a progression plays to hear the difference.</p>
          <ul>
            <li><strong>1-4-5-1</strong> - The foundation of rock, country, and blues</li>
            <li><strong>1-5-6-4</strong> - The "pop progression" used in hundreds of hit songs</li>
            <li><strong>2-5-1</strong> - The jazz turnaround; creates strong resolution</li>
            <li><strong>12 Bar Blues</strong> - The classic blues structure</li>
          </ul>
          
          <h3>Temperaments (Tuning Systems)</h3>
          <p>Here's a secret: the notes on a piano are slightly "out of tune" - on purpose! A <strong>temperament</strong> is a system for tuning notes. The challenge is mathematical: you can't have perfectly pure fifths (3:2 frequency ratio) AND perfectly pure thirds (5:4 frequency ratio) AND be able to play in any key. Different temperaments make different trade-offs.</p>
          
          <p><strong>Important:</strong> Except for Equal Tempered, all temperaments are "keyed" - they're designed around a specific root note. The samples in this app are tuned relative to C, so C Major represents the "home" key where the tuning is optimized. When you select a different root note, the temperament characteristics shift accordingly - you're essentially playing in a key that's "farther" or "closer" to the tuning's home base.</p>
          
          <p><strong>Equal Tempered</strong> (Modern Standard)</p>
          <p>The one temperament that isn't keyed. Every half-step is exactly the same size, so every key sounds identical and you can transpose freely. The trade-off: no interval is perfectly pure (e.g. a perfect fifth should be 3:2 = 1.5, but in equal temperament it's ~1.498). This tiny compromise in every interval is why modern instruments can play in any key. This is how virtually all contemporary instruments are tuned. Listen to <a href="#" class="demo-link" data-sequence="Equal Tempered,C,Major|C+E+G|2000">C Major</a> then <a href="#" class="demo-link" data-sequence="Equal Tempered,F#,Major|F#+A#+C#|2000">F# Major</a> - they sound identical in character.</p>
          
          <p><strong>Well Tempered</strong> (Baroque Era)</p>
          <p>Notes are adjusted so that all keys are playable, but each key retains its own "color." Keys close to C (few sharps/flats) sound purer and brighter because the tuning favors them. Keys far from C (like F# Major with six sharps) accumulate small tuning compromises that make them sound more tense and darker. Bach wrote "The Well-Tempered Clavier" specifically to showcase how each of the 24 keys has its own character. Compare <a href="#" class="demo-link" data-sequence="Well Tempered,C,Major|C+E+G|2000">C Major (pure)</a> to <a href="#" class="demo-link" data-sequence="Well Tempered,F#,Major|F#+A#+C#|2000">F# Major (edgy)</a> - you'll hear C sound clean while F# has more tension.</p>
          
          <p><strong>Pythagorean</strong> (Ancient Greek)</p>
          <p>Built entirely by stacking pure fifths (3:2 ratio) starting from C. Fifths sound incredibly pure, but here's the problem: if you stack 12 perfect fifths (C→G→D→A→E→B→F#→C#→G#→D#→A#→F→C), you should return to C - but mathematically, you land slightly sharp. This leftover error (called the "Pythagorean comma") has to go somewhere, creating one horribly out-of-tune interval called the <strong>"wolf fifth"</strong> - traditionally placed between G# and Eb where it was least likely to be needed. <a href="#" class="demo-link" data-sequence="Pythagorean|G#+D#|2500">Hear the wolf fifth</a> - instead of a pure fifth, you get a dissonant howl! Compare to a <a href="#" class="demo-link" data-sequence="Pythagorean|C+G|2500">pure C-G fifth</a>.</p>
          
          <p><strong>Carlos Super Just</strong></p>
          <p>Created by electronic music pioneer Wendy Carlos for her groundbreaking synthesizer albums. This is a form of "just intonation" - tuning based on pure mathematical ratios. Chords in C and nearby keys sound incredibly pure and beatless because their intervals are exact ratios (like 5:4 for major thirds). But this purity comes at a cost: keys far from C sound noticeably out of tune. Compare <a href="#" class="demo-link" data-sequence="Carlos Super Just,C,Major|C+E+G|2000">C Major (pure, locked-in)</a> to <a href="#" class="demo-link" data-sequence="Carlos Super Just,F#,Major|F#+A#+C#|2000">F# Major (buzzy, restless)</a> to hear the dramatic difference.</p>
          
          <h3>Spectrum Visualizer</h3>
          <p>Toggle <strong>Spectrum</strong> to see a visualization around the wheel that responds to the sounds being played. It combines frequency analysis with direct note tracking for a fun (if not scientifically precise) display.</p>
        </div>
      </div>
    </div>
    
    <!-- Loading overlay -->
    <div id="loading-overlay">
      <div class="loading-content">
        <div class="spinner"></div>
        <p>Loading sounds...</p>
        <p class="loading-progress"></p>
      </div>
    </div>
    
    <!-- Welcome overlay (first-time visitors) -->
    <div id="welcome-overlay" class="hidden">
      <div class="welcome-modal">
        <h2>Welcome to Interval</h2>
        <p>Explore music theory through an interactive visualization. Play notes, build chords, and discover how different tuning systems change the sound of music.</p>
        
        <div class="keyboard-diagram">
          <div class="keyboard-row">
            <span class="keyboard-label">All 12 notes:</span>
            <div class="keys">
              <kbd class="note-c">1</kbd><kbd class="note-cs">2</kbd><kbd class="note-d">3</kbd><kbd class="note-ds">4</kbd><kbd class="note-e">5</kbd><kbd class="note-f">6</kbd><kbd class="note-fs">7</kbd><kbd class="note-g">8</kbd><kbd class="note-gs">9</kbd><kbd class="note-a">0</kbd><kbd class="note-as">-</kbd><kbd class="note-b">=</kbd>
            </div>
          </div>
          <div class="keyboard-row offset">
            <span class="keyboard-label">Scale notes only:</span>
            <div class="keys">
              <kbd class="note-c">Q</kbd><kbd class="note-d">W</kbd><kbd class="note-e">E</kbd><kbd class="note-f">R</kbd><kbd class="note-g">T</kbd><kbd class="note-a">Y</kbd><kbd class="note-b">U</kbd><kbd class="note-c">I</kbd><kbd class="note-d">O</kbd><kbd class="note-e">P</kbd><kbd class="note-f">[</kbd><kbd class="note-g">]</kbd>
            </div>
          </div>
        </div>
        
        <p class="welcome-hint">You can also click notes on the wheel. Press <kbd>?</kbd> for full help.</p>
        
        <button id="welcome-start-btn" class="welcome-btn">Start Playing</button>
      </div>
    </div>
  </div>
</body>
</html>
